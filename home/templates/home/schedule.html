{% extends 'home/bootstrap.html' %}
{% load static %}
{% load extra %}
{% block head %}
    <title>SpoFit</title>
    <style>
        body, html, .row-offcanvas {
            height: 100%;
        }

        body {
            padding-top: 50px;
            background: #f5f5f5;
        }

        #sidebar {
            width: inherit;
            min-width: 220px;
            max-width: 220px;
            background-color: #f5f5f5;
            float: left;
            height: 100%;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #main {
            height: 100%;
            overflow: auto;
        }

        .navbar {
            background: #ce0010;
        }

        .navbar-inverse .navbar-nav > li > a:hover {
            background: #b3000f;
        }

        .navbar-inverse .navbar-nav > li > a, .navbar-inverse .navbar-brand {
            color: #ffffff;
        }

        .navbar-inverse {
            border: #ffffff;
        }

        .navbar-inverse .navbar-nav > .active > a, .navbar-inverse .navbar-nav > .active > a:hover {
            background: #b3000f;
        }

        .nav-pills > li.active > a, .nav-pills > li.active > a:hover {
            background: #b3000f;
        }

        .nav-pills > li > a {
            color: #000000;
        }

        .bolder {
            font-weight: bolder;
        }

        .selected {
            background: #b3000f;
            color: #FFFFFF !important;
        }

        .wrap {
            background: #fff;
            margin-bottom: 20px;
        }

        .left-border {
            padding: 5px;
            border-left: 3px solid #ce0010;
        }

        .white {
            background: #FFF;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            margin-top: 10px
        }

        .back {
            background: #ffffff;
            height: 100%;
        }

        .nav-stacked {
            padding-top: 5px;
        }

        /*
         * off Canvas sidebar
         * --------------------------------------------------
         */
        @media screen and (max-width: 768px) {
            .row-offcanvas {
                position: relative;
                -webkit-transition: all 0.25s ease-out;
                -moz-transition: all 0.25s ease-out;
                transition: all 0.25s ease-out;
                width: calc(100% + 220px);
            }

            .row-offcanvas-left {
                left: -220px;
            }

            .row-offcanvas-left.active {
                left: 0;
            }

            .sidebar-offcanvas {
                position: absolute;
                top: 0;
            }
        }
    </style>
{% endblock %}
{% block body %}

    <div class="row-offcanvas row-offcanvas-left">
        <div id="sidebar" class="sidebar-offcanvas">
            <div class="col-md-12 back">
                <ul class="nav nav-pills nav-stacked">
                    <li class="active"><a href="{% url 'home:schedule' %}">Schedule</a></li>
                    <li><a href="{% url 'home:points_table' %}">Points Table</a></li>
                    <li><a href="#">Result</a></li>
                    <li><a href="#">Section</a></li>
                    <li><a href="#">F.A.Q</a></li>
                </ul>

            </div>
        </div>
        <div id="main">
            <div id="refresh_winner">
                hello
            </div>
            <div class="col-md-12">
                <p class="visible-xs">
                    <button type="button" class="btn btn-danger btn-sm" data-toggle="offcanvas">
                        <i class="glyphicon glyphicon-chevron-left"></i>
                    </button>
                </p>
                <h2>Tournament Schedule</h2>
                {% for i in number_of_days %}
                    <div class="wrap">
                        <div class="row ">
                            <div class="col-md-1 bolder">Day {{ forloop.counter }}</div>
                            <div class="col-md-11">
                                <div class="row left-border">
                                    {% for j in matches_per_day_list %}
                                        {% test list1 i j matches_per_day as myFlag %}
                                        {% if myFlag %}
                                            <div class="col-sm-{% widthratio 12 matches_per_day 1 %}"
                                                 data-toggle="modal"
                                                 data-target="#exampleModalLong"
                                                 onclick="contentDecider('{% lookup list1 i j matches_per_day %}','{% lookup list2 i j matches_per_day %}','{% lookup match_id i j matches_per_day %}')">
                                                <div class="well white">
                                                    {#                                                    <p class="text-center" style="">Team A <br><b>V/S</b><br> Team B#}
                                                    {#                                                    </p>#}
                                                    <div class="">{% lookup list1 i j matches_per_day %} </div>
                                                    <strong>V/s</strong>
                                                    <div class="">{% lookup list2 i j matches_per_day %}</div>

                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}

            </div>
        </div><!--/row-offcanvas -->
        <!-- Modal -->
        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog"
             aria-labelledby="exampleModalLongTitle"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">Select the winner</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="text-align: center;">
                        <input id="radioTeamA" type="radio" name="winner">
                        <label id="opponent1" name="opponent1" for="radioTeamA"></label><br>
                        <strong>V/S</strong><br>
                        <input id="radioTeamB" type="radio" name="winner">
                        <label id="opponent2" name="opponent2" for="radioTeamB"></label>
                    </div>
                    <div class="modal-footer">
                        <button id="set-winner" name="get_user_name" data-dismiss="modal" value="{{ user_name }}">
                            Save
                            Winner
                        </button>

                    </div>
                </div>

            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $('[data-toggle=offcanvas]').click(function () {
                $('.row-offcanvas').toggleClass('active');
            });
        });
    </script>

    <script>
        function contentDecider(teamA, teamB, matchId) {
            var opponent1 = document.getElementById("opponent1");
            var opponent1_value = document.getElementById('radioTeamA');
            opponent1.innerHTML = teamA;
            opponent1_value.value = teamA + ' ' + matchId.toString();
            var opponent2 = document.getElementById("opponent2");
            var opponent2_value = document.getElementById('radioTeamB');
            opponent2.innerHTML = teamB;
            opponent2_value.value = teamB + ' ' + matchId.toString();
        }
    </script>

    {#    <script>#}
    {#        function setWinner() {#}
    {#            //alert("out");#}
    {#            var url = '/test_ajax/';#}
    {#            window.csrftoken="{% csrf_token %}";#}
    {#            var xhttp = new XMLHttpRequest();#}
    {#            xhttp.onreadystatechange = function () {#}
    {#                if (this.readyState == 4 && this.status == 200) {#}
    {#                    //alert("hi");#}
    {#                    document.getElementById("refresh_winner").innerHTML =#}
    {#                        this.responseText;#}
    {#                }#}
    {#            };#}
    {#            xhttp.open("GET", url, true);#}
    {#            xhttp.send();#}
    {#        }#}
    {#    </script>#}

    <script type="text/javascript">
        $(document).ready(function () {

            $("#set-winner").click(function () {
                //alert("inside");
                var match_id = document.getElementById('radioTeamA').value;
                //alert(match_id);
                if (document.getElementById('radioTeamA').checked) {
                    winnerName = document.getElementById('radioTeamA').value;
                }
                else {
                    winnerName = document.getElementById('radioTeamB').value;
                }
                $.ajax({
                    type: "POST",
                    url: '/schedule/',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'winner_name': winnerName,
                        'match_id': match_id
                    },
                    success: function (data) {
                        // grab the inner html of the returned div
                        // so you don't nest a new div#refresh-this-div on every call
                        //var html = $(data).filter('#refresh-this-div').html();
                        $('#refresh_winner').html(data);
                    }
                });
            });
        });
    </script>
{% endblock %}